---
title: "母関数と包除原理の適用例"
date: 2020-10-26T00:15:51+09:00
draft: true
---

$lsx(..)

引き続き，有限集合$A$とその元に対する$n$個の性質の集合$S$があるとし，各$T \subset S$について$f_=(T)$を$T$の性質のみをすべて満たす元の個数，$f_\geq$を少なくとも$T$の性質はすべて満たす元の個数とする．ここで$f_\geq(T) = \sum_{Y \supset T} f_=(T)$．

前回はこの等式が出てきた．

$$ f_=(T) = \sum_{Y \supset T} (-1)^{\#(Y-T)} f_\geq (Y) $$

これよりこの等式を導くことができる．きれい

$$ \sum_X f_=(X) x^{\#X} = \sum_Y f_\geq(Y) (x-1)^{\#Y} $$

### 証明1

$$
\begin{aligned}
    \text{左辺} &= \sum_X \sum_{Y \supset X} (-1)^{\#(Y-X)} f_\geq(Y) x^{\#X} \\
                &= \sum_Y f_\geq(Y) \sum_{Y \supset X} (-1)^{\#(Y-X)} x^{\#X} \\
                &= \sum_Y f_\geq(Y) \sum_{k} \binom{\#Y}{k} (-1)^{\#Y-k} x^k \\
                &= \text{右辺}.
\end{aligned}
$$

### 証明2

次数が有限であることから，$x$が任意の正整数であるとして等号を示せば十分．

任意の$S$の部分集合$X$について，各元に$[x] = \{1,2,\ldots,x\}$の要素を割り当てることを考える．$x$が割り当てられた元を$X$から取り除く操作を考えると，これは$[x]^{\#X}$から$\{(Y, v) \mid Y \subset X, v \in [x-1]^{\#Y}\}$への全単射になっている．それぞれの元の個数に$f_=(X)$を掛けて足し合わせると，示したい式が得られる．

（これEC2章の問題2なんですが，これでいいのかは分からない）

### $\#T$に注目した書き換え

$e_r = \sum_{\#T = r} f_=(T)$，$g_r = \sum_{\#T = r} f_\geq(T)$とおく．$f_=(T) = \sum_{Y \supset T} (-1)^{\#(Y-T)} f_\geq(T)$であったが，各$(T, Y)$（$\#T = r$，$\#Y = t$）について$f_\geq(Y)$の$f_=(T)$への寄与を考えることにより，

$$ e_r = \sum_t \binom{t}{r} (-1)^{t-r} g_t. $$

また，今回示した等式を書き換えれば，

$$ \sum_{r} e_r x^r = \sum_{r} g_r (x-1)^r. $$

$x^r$の項の係数に注目すれば，同じことを言っていることがわかる．

つまり，たとえば数列$(g_r)$の母関数を求めてから$x$を$x-1$で置換すれば，うまい具合に篩となって$(e_r)$の母関数が手に入る．またこれを$r$回微分して$r!$で割れば，一致する$e_r$の式が出てくる．

実は，これを$1$回微分して$x=1$を代入すると，$g_1$が$A$の各元$a$について$a$が満たす性質の個数をすべて足し合わせた値だということがわかる．これを$\#A$で割れば**各元が満たす性質の個数の平均**が出る．便利．

## 例1 攪乱順列（完全順列）

$[n]$の順列$p \in \mathfrak{S}_n$のうち，不動点（$p(i)=i$を満たす$i \in [n]$）がちょうど$r$個あるものを数え上げる．$r=0$の場合は攪乱順列の個数（モンモール数）に相当する．

順列$p \in \mathfrak{S}_n = A$に対し，性質$i$を$p(i)=i$であることとする．つまり$f_\geq(T)$とは各$i \in T$について$i$が不動点であるような順列の個数を表す．前回と同様に$\#T = i$について$a(n-i) = f_=(T)$，$b(n-i) = f_\geq(T)$とする．

求めたいのは$e_r = \binom{n}{r}a(n-r)$であるが，$b(n-i) = (n-i)!$より，前回の結果から，
$$ a(n-r) = \sum_{i=0}^{n-r} \binom{n-r}{i}(-1)^{n-r-i} i! = (n-r)! \sum_{i=0}^{n-r} \frac{(-1)^{n-r-i}}{(n-r-i)!} = (n-r)! \sum_{i=0}^{n-r} \frac{(-1)^i}{i!}, $$

$$ e_r = \binom{n}{r}a(n-r) = \frac{n!}{r!}\sum_{i=0}^{n-r} \frac{(-1)^i}{i!}. $$

$r=0$とすれば，

$$ e_0 = a(n) = n! \sum_{i=0}^n \frac{(-1)^i}{i!}. $$

これらが$n!/r!\cdot\exp(-1)$で近似できることも分かる．

代わりに今回証明したものを用いて考えても，出てくる式は同じ．また，

$$ \sum_{r} e_r x^r = \sum_{r} \binom{n}{r} (n-r)! (x-1)^r = n! \sum_{r=0}^n \frac{(x-1)^r}{r!}. $$

この両辺を$1$回微分して$x=1$を代入し，$n!$で割ると，各順列に対して不動点の個数の平均が出てくるのだった．その値は$1$になっている．順列$p$を一様ランダムに選択したときの期待値を考えれば確かに正しい．予定調和感がある．

$\exp$っぽさは$(x-1)^r/r!$から来ているので，$e$なんて案外いくらでも見つかるものかもしれない．

## 例2 順列中の$k$–サイクル

不動点を一般化して，$[n]$の順列をサイクルに分解したときに長さ$k$のサイクルがちょうど$r$個あるものを数え上げる．

前回は性質$i$を$i$が不動点であることとしたが，今回はサイクルに属する$k$個を選び，それらを$(k-1)!$通りの方法で並べるので，全部で$\binom{n}{k}(k-1)!$通りのサイクル$=$性質を考えることになる．これらの性質の集合を$S$とする．

ここで$f_\geq(T)$（$T \subset S$）を考える．$T$は長さ$k$のサイクルの集合であるが，これらのサイクルを含む順列の個数を考えると，与えられたサイクルがdisjointであれば$f_\geq(T) = (n-k\cdot\#T)!$，そうでなければ$f_\geq(T) = 0$．

ここで$g_r = \sum_{\#T \geq r} f_\geq(T)$，すなわち$r$個のサイクルを含む順列の個数を考える．Disjointな$k$元集合を順番を無視して$r$個とり，残りを任意に並べるので，
$$ g_r = \frac{1}{r!}\cdot\frac{n!}{(k!)^r(n-kr)!}\cdot((k-1)!)^r(n-kr)! = \frac{n!}{k^rr!}. $$

ただし上記の議論は$r \leq n/k$の場合である．$r \gt n/k$の場合はそのような順列は存在しないので，$g_r = 0$．

ここで$g_1/n! = 1/k$より，順列中の$k$–サイクルの個数の平均は$1/k$であることが分かった．これの直感的な説明を試みる．一様ランダムに順列をとってくる．前回は$1$つの元の行き先を考えたが，同様に$\binom{[n]}{k}$のうち順列に対して不動であるものの期待値は$1$．$k$個の元の順列$k!$個のうちサイクルは$(k-1)!$個なのでこれがサイクルである確率は$1/k$．

というわけで，
$$ e_r = \sum_t \binom{t}{r} (-1)^{t-r} g_t = (-1)^r n!\sum_{t \leq n/k} \binom{t}{r} \frac{(-1/k)^t}{t!}. $$

$k=1$とすると例1と一致することも確認．$t$が大きくなるほど$k$の影響も指数的に大きくなっていて，なるほどという感じ．

## おまけ EC問題3

$e_r = \sum_{\#T = r} f_=(T)$だったが，ここで$e_{\geq r} = \sum_{\#T \geq r} f_=(T)$を考える．これは$g_r = \sum_{\#T = r} f_\geq(T)$と違い，$\#T \geq r$である$T$に対して$f(T)$はちょうど$1$回ずつ寄与している．$e_{\geq r} = \sum_{t \geq r} e_t$なので，母関数を考えると，

$$ \sum_r e_{\geq r} x^r = \frac{x}{x-1} \sum_r e_r = \frac{x}{x-1} \sum_t g_t(x-1)^t = x \sum_t g_t(x-1)^{t-1}$$

これの$x^r$の係数を考えると，$e_{\geq r} = \sum_{t \geq r} \binom{t-1}{r-1} (-1)^{t-r} g_t$が分かった．

### 参考文献

Richard P. Stanley, Enumerative Combinatorics, Volume I Second Edition, 2012

Herbert S. Wilf, generatingfunctionology, Second Edition, 1994
